## 块级元素

我对html的了解还停留在这只是一个超文本标记语言，没有太大的意义。在面试的时候也只是因为面试的时候看了下语义化标签，新增的h5标签例如canvas，video等等。

事情的转机是我加入某个技术交流群的人里面，有人提问div是不是块级元素。
<Image srcType="surprise"/>
这是什么吊问题，我在几百年前还在花果山的时候就知道div，p等等都是块级元素啊，但后来他告诉根本没有所谓的块级元素和行内元素，早在很多年前谷歌浏览器就已经是通过浏览器人为的给予div css样式才变成了所谓的块级元素，正确名称应为块盒，同理行内元素也是通过浏览器赋值为行盒。

```css
div {                                           user agent stylesheet
  display: block
} 

```

## html渲染

这个问题其实大家都肯定会在面试当中遇见过，其中最经典的莫过于从浏览器地址栏里面输入网址按下回车，发送网络请求，缓存机制，三次握手，四次挥手，得到数据亦或是HTML字符串。

这里重点要讲得就是浏览器将HTML渲染为像素点直至成画的过程，如果大家对请求网络部分不熟悉的可以参考 *<https://juejin.cn/post/6844903958624878606>*，非常非常经典的文章，所有初级前端都应该看的一篇文章。

当浏览器的网络线程收到 HTML 之后，会传递一个渲染任务，并将其传递给渲染主线程的事件队列。

渲染主线程取出事件队列中的渲染任务，开启渲染流程。整个渲染流程分为多个阶段，分别是： 解析HTML、样式计算、布局、分层、绘制、分块、光栅化、画。我们只需要了解前6项就好了。

<Image srcType="renderHtml" width="100vw" height="300px"/>

### 解析HTML

渲染进程是由上至下的文档流解析HTML,当遇到CSS的时候会解析CSS，解析CSS的时候大家肯定都听说过不会堵塞HTML解析，其中的原因是因为浏览器内置了辅助线程去解析，解析完毕直接传递给主渲染进程就好了。

遇见JS会立即执行，这也是会堵塞渲染的根本原因，为什么浏览器会让JS立即执行呢？ 是因为JS里面的脚本代码很有可能影响其中的布局所以这是浏览器综合考虑。
所以最好的解决方案是将脚本注入到最底部，或者是在script标签定义defer属性。

解析完毕之后将会得到 DOM 树和 CSSOM 树，浏览器的默认样式、内部样式、外部样式、行内样式均会包含在 CSSOM 树中。其中值得一提的是这两个树都是以对象形式存储的，也是为以后咱们自己操作整体样式和DOM做了功夫，也就是比如我们写在style标签里的样式也可以通过JS控制，注意，是操作整体的style,而不是单独的元素。（CSS章节会提到）

### 样式计算

主线程会遍历得到的 DOM 树，依次为树中的每个节点计算出它最终的样式，称之为 Computed Style。

在这一过程中，很多预设值会变成绝对值，比如`green`会变成`rgb(0,255,0)`；相对单位会变成绝对单位，比如`em`会变成`px`

其中又出现CSS的层叠，继承以及浏览器的默认样式，比如为什么a标签它会自带颜色就是因为浏览器的自带样式，而为什么我们打开谷歌控制台查看color: green;会变成color: rgba(0,255,0)就是因为浏览器默认样式加上我们手动提供的样式相计算得来的。大家有兴趣可以查看每个元素都有上百种样式
<Image srcType="totalStyle" width="100vw" height="300px"/>
这一步完成后，会得到一棵带有样式的 DOM 树。

### 布局

布局阶段会依次遍历 DOM 树的每一个节点，计算每个节点的几何信息。例如节点的宽高、相对包含块的位置。

大部分时候，DOM 树和布局树并非一一对应。

比如`display:none`的节点没有几何信息，因此不会生成到布局树；又比如使用了伪元素选择器，虽然 DOM 树中不存在这些伪元素节点，但它们拥有几何信息，所以会生成到布局树中。还有匿名行盒、匿名块盒等等都会导致 DOM 树和布局树无法一一对应。
匿名行盒: W3C规范所有文字都应该包含在行盒

```html
<p>hello<p> // 看起来只有一个p标签其实内置了一个行盒

```
